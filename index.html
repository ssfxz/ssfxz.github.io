<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="default">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="LiuY&#39;s TechBlog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="LiuY&#39;s TechBlog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LiuY&#39;s TechBlog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>LiuY's TechBlog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LiuY's TechBlog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/02/P-NP-NPC-NP-Hard/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiuY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiuY's TechBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/02/P-NP-NPC-NP-Hard/" itemprop="url">P NP NPC NP-Hard</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-02T14:23:59+08:00">
                2018-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="P-NP-NPC-NP-Hard-问题的定义"><a href="#P-NP-NPC-NP-Hard-问题的定义" class="headerlink" title="P NP NPC NP-Hard 问题的定义"></a>P NP NPC NP-Hard 问题的定义</h3><p><strong>P Problem：</strong><br>如果一个问题可以找到一个能在多项式的时间里解决它的算法，那么这个问题就属于P问题。</p>
<p><strong>NP Problem：</strong><br>NP问题不是非P类问题。NP问题是指可以在多项式的时间里验证一个解的问题。NP问题的另一个定义是，可以在多项式的时间里猜出一个解的问题。</p>
<p><strong>NP-Complete Problem：</strong><br>同时满足下面两个条件的问题就是NPC问题。首先，它得是一个NP问题；然后，所有的NP问题都可以约化到它。</p>
<p><strong>NP-Hard Problem：</strong><br>NP-Hard问题是这样一种问题，它满足NPC问题定义的第二条但不一定要满足第一条（就是说，NP-Hard问题要比 NPC问题的范围广）。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/21/CanvasPerformance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiuY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiuY's TechBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/21/CanvasPerformance/" itemprop="url">Improving HTML5 Canvas Performance</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-21T16:21:17+08:00">
                2018-03-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="提高Canvas渲染性能的几点总结"><a href="#提高Canvas渲染性能的几点总结" class="headerlink" title="提高Canvas渲染性能的几点总结"></a>提高Canvas渲染性能的几点总结</h2><ul>
<li>预渲染到离屏画布</li>
</ul>
<p>no pre-rendering:</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// canvas, context are defined</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span><span class="params">()</span> &#123;</span></div><div class="line">  drawMario(context);</div><div class="line">  requestAnimationFrame(<span class="built_in">render</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>pre-rendering:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var m_canvas = document.createElement(<span class="string">'canvas'</span>)<span class="comment">;</span></div><div class="line">m_canvas.width = <span class="number">64</span><span class="comment">;</span></div><div class="line">m_canvas.height = <span class="number">64</span><span class="comment">;</span></div><div class="line">var m_context = m_canvas.getContext(‘<span class="number">2</span>d’)<span class="comment">;</span></div><div class="line">drawMario(m_context)<span class="comment">;</span></div><div class="line"></div><div class="line">function render() &#123;</div><div class="line">  <span class="built_in">context</span>.drawImage(m_canvas, <span class="number">0</span>, <span class="number">0</span>)<span class="comment">;</span></div><div class="line">  requestAnimationFrame(render)<span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>集中调用canvas</li>
</ul>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="built_in">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">points</span>.<span class="built_in">length</span> - <span class="number">1</span>; i++) &#123;</div><div class="line">  <span class="built_in">var</span> p1 = <span class="built_in">points</span>[i];</div><div class="line">  <span class="built_in">var</span> p2 = <span class="built_in">points</span>[i+<span class="number">1</span>];</div><div class="line">  <span class="built_in">context</span>.beginPath();</div><div class="line">  <span class="built_in">context</span>.moveTo(p1.x, p1.y);</div><div class="line">  <span class="built_in">context</span>.lineTo(p2.x, p2.y);</div><div class="line">  <span class="built_in">context</span>.stroke();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">context</span>.beginPath();</div><div class="line"><span class="keyword">for</span> (<span class="built_in">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">points</span>.<span class="built_in">length</span> - <span class="number">1</span>; i++) &#123;</div><div class="line">  <span class="built_in">var</span> p1 = <span class="built_in">points</span>[i];</div><div class="line">  <span class="built_in">var</span> p2 = <span class="built_in">points</span>[i+<span class="number">1</span>];</div><div class="line">  <span class="built_in">context</span>.moveTo(p1.x, p1.y);</div><div class="line">  <span class="built_in">context</span>.lineTo(p2.x, p2.y);</div><div class="line">&#125;</div><div class="line"><span class="built_in">context</span>.stroke();</div></pre></td></tr></table></figure>
<ul>
<li>避免不必要的画布状态改变</li>
</ul>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">for (var i = <span class="number">0</span><span class="comment">; i &lt; STRIPES; i++) &#123;</span></div><div class="line">  <span class="built_in">context</span>.fillStyle = (i % <span class="number">2</span> ? COLOR1 : COLOR2)<span class="comment">;</span></div><div class="line">  <span class="built_in">context</span>.fillRect(i * GAP, <span class="number">0</span>, GAP, <span class="number">480</span>)<span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">context.fillStyle = COLOR1;</div><div class="line">for (var i = <span class="number">0</span>; i &lt; STRIPES/<span class="number">2</span>; i++) &#123;</div><div class="line">  context.fillRect((i*<span class="number">2</span>) * GAP, <span class="number">0</span>, GAP, <span class="number">480</span>);</div><div class="line">&#125;</div><div class="line">context.fillStyle = COLOR2;</div><div class="line">for (var i = <span class="number">0</span>; i &lt; STRIPES/<span class="number">2</span>; i++) &#123;</div><div class="line">  context.fillRect((i*<span class="number">2</span>+<span class="number">1</span>) * GAP, <span class="number">0</span>, GAP, <span class="number">480</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>仅渲染视窗部分</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">context.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="selector-tag">canvas</span><span class="selector-class">.width</span>, <span class="selector-tag">canvas</span>.<span class="attribute">height</span>);</div></pre></td></tr></table></figure>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">context</span>.fillRect(<span class="built_in">last</span>.x, <span class="built_in">last</span>.y, <span class="built_in">last</span>.<span class="built_in">width</span>, <span class="built_in">last</span>.<span class="built_in">height</span>);</div></pre></td></tr></table></figure>
<ul>
<li>将多层画布用于复杂场景</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"bg"</span> <span class="attr">width</span>=<span class="string">"640"</span> <span class="attr">height</span>=<span class="string">"480"</span> <span class="attr">style</span>=<span class="string">"position: absolute; z-index: 0"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"fg"</span> <span class="attr">width</span>=<span class="string">"640"</span> <span class="attr">height</span>=<span class="string">"480"</span> <span class="attr">style</span>=<span class="string">"position: absolute; z-index: 1"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>避免使用 shadowBlur 效果</li>
</ul>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">context.shadowOffsetX = <span class="number">5</span>;</div><div class="line">context.shadowOffsetY = <span class="number">5</span>;</div><div class="line"><span class="comment">//context.shadowBlur = 4;</span></div><div class="line">context.shadowColor = 'rgba(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>)';</div><div class="line">context.fillRect(<span class="number">20</span>, <span class="number">20</span>, <span class="number">150</span>, <span class="number">100</span>);</div></pre></td></tr></table></figure>
<ul>
<li>了解清空画布的各种方法</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">context.clearRect(<span class="number">0</span>, <span class="number">0</span>, <span class="attribute">width</span>, height);</div><div class="line"><span class="selector-tag">canvas</span><span class="selector-class">.width</span> = <span class="selector-tag">canvas</span>.<span class="attribute">width</span>;</div></pre></td></tr></table></figure>
<ul>
<li>避免使用浮点数坐标</li>
</ul>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">rounded = (<span class="number">0.5</span> + somenum) | <span class="number">0</span>;</div><div class="line">rounded = ~~ (<span class="number">0.5</span> + somenum);</div><div class="line"><span class="comment">// Finally, a left bitwise shift.</span></div><div class="line">rounded = (<span class="number">0.5</span> + somenum) &lt;&lt; <span class="number">0</span>;</div></pre></td></tr></table></figure>
<ul>
<li>使用 <code>requestAnimationFrame</code> 优化你的动画</li>
</ul>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var x = <span class="number">100</span><span class="comment">;</span></div><div class="line">var y = <span class="number">100</span><span class="comment">;</span></div><div class="line">var lastRender = Date.now()<span class="comment">;</span></div><div class="line">function render() &#123;</div><div class="line">  var delta = Date.now() - lastRender<span class="comment">;</span></div><div class="line">  x += delta<span class="comment">;</span></div><div class="line">  y += delta<span class="comment">;</span></div><div class="line">  <span class="built_in">context</span>.fillRect(x, y, W, H)<span class="comment">;</span></div><div class="line">  requestAnimationFrame(render)<span class="comment">;</span></div><div class="line">&#125;</div><div class="line">render()<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>参考链接：<br><a href="https://www.html5rocks.com/en/tutorials/canvas/performance/" target="_blank" rel="external">https://www.html5rocks.com/en/tutorials/canvas/performance/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/02/OSM-Tile-Server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiuY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiuY's TechBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/02/OSM-Tile-Server/" itemprop="url">Debian8上搭建OpenStreetMap服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-02T10:40:28+08:00">
                2018-03-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>近期的图表需求中强调了GIS地图的优先级，因此我们需要一个稳定且低成本的GIS地图服务器，对比高德和百度的商业合作解决方案后，我们决定使用开源地图OpenStreetMap。</p>
<p>需要强调的是OpenStreetMap的地图数据是免费开源的，但它的地图服务不是，因此如果想使用OpenStreetMap的地图服务，有两个选择：选择付费的服务提供商（例如mapbox）或自己搭建地图服务器，考虑到服务器响应速度和地图的功能需求，最终决定我们自己动手搭建OpenStreetMap瓦片服务器。</p>
<p>本文中使用的服务器操作系统为Debian8.8，部署过程需要root权限。</p>
<h3 id="创建系统用户"><a href="#创建系统用户" class="headerlink" title="创建系统用户"></a>创建系统用户</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">sudo</span> -iu root</div><div class="line"><span class="keyword">adduser </span>youdata</div></pre></td></tr></table></figure>
<h3 id="PostgreSQL-amp-Postgis"><a href="#PostgreSQL-amp-Postgis" class="headerlink" title="PostgreSQL &amp; Postgis"></a>PostgreSQL &amp; Postgis</h3><p>PostgreSQL用来存储地图数据，PostGIS是其地理空间插件，相比MySQL，PostgreSQL拥有更好的几何类型支持和空间数据库扩展。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># root用户安装PostgreSQL和插件</span></div><div class="line">sudo -iu root</div><div class="line">apt install postgresql-<span class="number">9.4</span>-postgis-<span class="number">2.1</span> postgresql-contrib-<span class="number">9.4</span></div><div class="line"></div><div class="line"><span class="comment"># 切换到postgres用户编辑数据库</span></div><div class="line">sudo -iu postgres</div><div class="line">cd ~</div><div class="line"></div><div class="line"><span class="comment"># 创建数据库用户</span></div><div class="line">createuser youdata</div><div class="line"></div><div class="line"><span class="comment"># 创建地图数据库</span></div><div class="line">createdb -E UTF8 -O youdata gis</div><div class="line"></div><div class="line"><span class="comment"># 为gis数据库增加hstore和postgis扩展</span></div><div class="line">psql</div><div class="line">\c gis</div><div class="line">CREATE EXTENSION postgis;</div><div class="line">CREATE EXTENSION hstore;</div><div class="line"><span class="comment"># Should answer CREATE EXTENSION</span></div><div class="line"><span class="keyword">exit</span></div></pre></td></tr></table></figure>
<h3 id="osm2pgsql"><a href="#osm2pgsql" class="headerlink" title="osm2pgsql"></a>osm2pgsql</h3><p>osm2pgsql的作用是将OSM数据转换并导入PostGIS里的工具</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo -iu root</div><div class="line">apt <span class="keyword">install</span> osm2pgsql</div></pre></td></tr></table></figure>
<h3 id="Stylesheet"><a href="#Stylesheet" class="headerlink" title="Stylesheet"></a>Stylesheet</h3><p>获取样式表</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">su youdata</div><div class="line">cd ~</div><div class="line">wget https:<span class="comment">//github.com/gravitystorm/openstreetmap-carto/archive/v2.29.1.tar.gz</span></div><div class="line">tar -xzf v2.<span class="number">29.1</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></div></pre></td></tr></table></figure>
<h3 id="OSM-Data"><a href="#OSM-Data" class="headerlink" title="OSM Data"></a>OSM Data</h3><p>获取OSM的地图数据</p>
<p><a href="http://download.geofabrik.de/index.html" target="_blank" rel="external">http://download.geofabrik.de/index.html</a></p>
<p><a href="http://planet.openstreetmap.org/pbf/" target="_blank" rel="external">http://planet.openstreetmap.org/pbf/</a></p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">su</span> youdata</div><div class="line"><span class="keyword">cd</span> ~</div><div class="line">http:<span class="comment">//download.geofabrik.de/asia/china-latest.osm.pbf</span></div></pre></td></tr></table></figure>
<h3 id="导入地图数据"><a href="#导入地图数据" class="headerlink" title="导入地图数据"></a>导入地图数据</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">su youdata</div><div class="line">cd ~</div><div class="line">osm2pgsql --slim -d gis -C <span class="number">6000</span> --hstore -S openstreetmap-carto-<span class="number">2.29</span>.<span class="number">1</span>/openstreetmap-carto<span class="selector-class">.style</span> china-latest<span class="selector-class">.osm</span><span class="selector-class">.pbf</span></div></pre></td></tr></table></figure>
<h3 id="mod-tile"><a href="#mod-tile" class="headerlink" title="mod_tile"></a>mod_tile</h3><p>mod_tile是OSM的地图瓦片服务，没有Debian8的适配版本，需要从源码进行编译</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">su youdata</div><div class="line"><span class="keyword">cd</span> ~</div><div class="line">wget http<span class="variable">s:</span>//github.<span class="keyword">com</span>/openstreetmap/mod_tile/archive/<span class="number">6</span>c2cb243e4c8b047950ab8062cd66245f20a5d2f.tar.gz -O mod_tile.tar.gz</div><div class="line">tar -xzf mod_tile.tar.gz</div><div class="line">mv mod_tile-<span class="number">6</span>c2cb243e4c8b047950ab8062cd66245f20a5d2f mod_tile</div><div class="line"></div><div class="line">sudo -<span class="keyword">iu</span> root</div><div class="line">apt install autoconf libtool libmapnik-dev apache2-dev</div><div class="line"><span class="keyword">exit</span></div><div class="line"></div><div class="line"><span class="keyword">cd</span> mod_tile</div><div class="line">./autogen.<span class="keyword">sh</span></div><div class="line">./configure</div><div class="line"><span class="keyword">make</span></div><div class="line"></div><div class="line">sudo -<span class="keyword">iu</span> root</div><div class="line"><span class="keyword">cd</span> /home/youdata/mod_tile</div><div class="line"><span class="keyword">make</span> install</div><div class="line"><span class="keyword">make</span> install-mod_tile</div><div class="line"><span class="keyword">exit</span></div></pre></td></tr></table></figure>
<h3 id="Generate-Mapnik-Style"><a href="#Generate-Mapnik-Style" class="headerlink" title="Generate Mapnik Style"></a>Generate Mapnik Style</h3><p>服务端地图渲染</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="string">sudo </span>-<span class="string">iu </span><span class="string">root</span></div><div class="line"><span class="string">apt </span><span class="string">install </span><span class="string">curl </span><span class="string">unzip </span><span class="string">gdal-bin </span><span class="string">mapnik-utils </span><span class="string">node-carto</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">#</span> 在线获取<span class="string">shapefiles</span></div><div class="line"><span class="string">su </span><span class="string">youdata</span></div><div class="line"><span class="string">cd </span>~/<span class="string">openstreetmap-carto-</span>2.<span class="string">29.</span>1/</div><div class="line">./<span class="built_in">get-shapefiles.sh</span></div><div class="line"><span class="built_in"></span></div><div class="line"><span class="built_in">#</span> 修改数据库名称 本例中不用修改</div><div class="line"><span class="comment"># sed -i 's/"dbname": "gis"/"dbname": "mygis"/' project.mml</span></div><div class="line"></div><div class="line"><span class="string">carto </span><span class="string">project.</span><span class="string">mml </span>&gt; <span class="string">style.</span><span class="string">xml</span></div></pre></td></tr></table></figure>
<h3 id="Font"><a href="#Font" class="headerlink" title="Font"></a>Font</h3><p>安装地图渲染所需要的中文字体</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo -iu root</div><div class="line">apt-<span class="builtin-name">get</span> install unifont</div></pre></td></tr></table></figure>
<h3 id="renderd"><a href="#renderd" class="headerlink" title="renderd"></a>renderd</h3><p>配置服务端地图渲染</p>
<p>修改/usr/local/etc/renderd.conf</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="section">[mapnik]</span></div><div class="line"><span class="attr">plugins_dir</span>=/usr/lib/mapnik/<span class="number">2.2</span>/input/</div><div class="line"><span class="attr">font_dir</span>=/usr/share/fonts/<span class="literal">true</span>type/unifont</div><div class="line"><span class="attr">font_dir_recurse</span>=<span class="number">1</span></div><div class="line"></div><div class="line"><span class="section">[default]</span></div><div class="line"><span class="attr">URI</span>=/osm/</div><div class="line"><span class="attr">XML</span>=/home/youdata/openstreetmap-carto-<span class="number">2.29</span>.<span class="number">1</span>/style.xml</div><div class="line"><span class="attr">HOST</span>=localhost</div></pre></td></tr></table></figure>
<p>修改/home/youdata/mod_tile/debian/renderd.init</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attr">DAEMON</span>=/usr/local/bin/<span class="variable">$NAME</span></div><div class="line"><span class="attr">DAEMON_ARGS</span>=<span class="string">" -c /usr/local/etc/renderd.conf"</span></div><div class="line"><span class="attr">RUNASUSER</span>=youdata</div></pre></td></tr></table></figure>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">sudo -iu youdata</div><div class="line">cd /home/youdata</div><div class="line">cp mod_tile/debian/renderd.init /etc/init.d/renderd</div><div class="line">chmod a+x /etc/init.d/renderd</div><div class="line"></div><div class="line">mkdir -p /var/<span class="class"><span class="keyword">lib</span>/<span class="title">mod_tile</span></span></div><div class="line">chown youdata /var/<span class="class"><span class="keyword">lib</span>/<span class="title">mod_tile</span></span></div><div class="line"></div><div class="line">systemctl daemon-reload</div><div class="line">service renderd start</div></pre></td></tr></table></figure>
<h3 id="Apache2"><a href="#Apache2" class="headerlink" title="Apache2"></a>Apache2</h3><p>文件服务器</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apt <span class="keyword">install</span> apache2</div></pre></td></tr></table></figure>
<p>编辑/etc/apache2/sites-enabled/000-default.conf</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">LoadTileConfigFile /usr/local/etc/renderd.<span class="keyword">conf</span></div><div class="line">ModTileRenderdSocketName /var/run/renderd/renderd.sock</div><div class="line"># Timeout before giving <span class="keyword">up</span> <span class="keyword">for</span> <span class="keyword">a</span> tile <span class="keyword">to</span> <span class="keyword">be</span> rendered</div><div class="line">ModTileRequestTimeout <span class="number">0</span></div><div class="line"># Timeout before giving <span class="keyword">up</span> <span class="keyword">for</span> <span class="keyword">a</span> tile <span class="keyword">to</span> <span class="keyword">be</span> rendered that <span class="keyword">is</span> otherwise missing</div><div class="line">ModTileMissingRequestTimeout <span class="number">30</span></div></pre></td></tr></table></figure>
<p>如果需要开启跨域访问的话</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo a2enmod headers</div><div class="line">sudo vi <span class="regexp">/etc/</span>apache2<span class="regexp">/sites-available/</span><span class="number">000</span>-<span class="keyword">default</span>.conf</div></pre></td></tr></table></figure>
<p>编辑添加：</p>
<p>LoadModule headers_module modules/mod_headers.so<br>Header set Access-Control-Allow-Origin *</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="section">&lt;VirtualHost *:80&gt;</span></div><div class="line">    <span class="attribute"><span class="nomarkup">LoadModule</span></span> headers_module modules/mod_headers.so</div><div class="line">    </div><div class="line">    <span class="attribute">ServerAdmin</span> webmaster@localhost</div><div class="line">    <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> /var/www/html</div><div class="line">    <span class="attribute"><span class="nomarkup">Header</span></span> set Access-Control-Allow-Origin *</div><div class="line"></div><div class="line"><span class="section">&lt;/VirtualHost&gt;</span></div></pre></td></tr></table></figure>
<p>启动服务</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">echo <span class="string">"LoadModule tile_module /usr/lib/apache2/modules/mod_tile.so"</span> &gt; /etc/apache2/mods-available/tile.load</div><div class="line">ln -s /etc/apache2/mods-available/tile.load /etc/apache2/mods-enabled/</div><div class="line"></div><div class="line">service apache2 restart</div></pre></td></tr></table></figure>
<h3 id="测试服务是否正常"><a href="#测试服务是否正常" class="headerlink" title="测试服务是否正常"></a>测试服务是否正常</h3><p>访问<a href="http://localhost/osm/0/0/0.png" target="_blank" rel="external">http://localhost/osm/0/0/0.png</a></p>
<p>通过以下命令输出日志<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo tail -f /var/<span class="built_in">log</span>/syslog <span class="string">| grep "</span> TILE <span class="string">"</span></div></pre></td></tr></table></figure></p>
<p>使用openstreetmap重定向测试地图服务</p>
<p>安装chrome重定向插件”Switcheroo Redirector”</p>
<p><a href="https://chrome.google.com/webstore/detail/switcheroo-redirector/cnmciclhnghalnpfhhleggldniplelbg?hl=en" target="_blank" rel="external">https://chrome.google.com/webstore/detail/switcheroo-redirector/cnmciclhnghalnpfhhleggldniplelbg?hl=en</a></p>
<p>添加以下重定向：</p>
<ul>
<li><a href="https://tile-a.openstreetmap.fr/hot/" target="_blank" rel="external">https://tile-a.openstreetmap.fr/hot/</a> =&gt; <a href="http://10.165.124.194/osm/" target="_blank" rel="external">http://10.165.124.194/osm/</a></li>
<li><a href="https://tile-a.openstreetmap.fr/hot/" target="_blank" rel="external">https://tile-a.openstreetmap.fr/hot/</a> =&gt; <a href="http://10.165.124.194/osm/" target="_blank" rel="external">http://10.165.124.194/osm/</a></li>
<li><a href="https://tile-a.openstreetmap.fr/hot/" target="_blank" rel="external">https://tile-a.openstreetmap.fr/hot/</a> =&gt; <a href="http://10.165.124.194/osm/" target="_blank" rel="external">http://10.165.124.194/osm/</a></li>
</ul>
<p>访问<a href="http://www.openstreetmap.org/" target="_blank" rel="external">http://www.openstreetmap.org/</a></p>
<p>OSM中选择”Humanitarian”图层</p>
<h3 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h3><p><a href="https://wiki.debian.org/OSM/tileserver/jessie#Install_mod_tile" target="_blank" rel="external">https://wiki.debian.org/OSM/tileserver/jessie#Install_mod_tile</a></p>
<p><a href="https://switch2osm.org/manually-building-a-tile-server-16-04-2-lts/" target="_blank" rel="external">https://switch2osm.org/manually-building-a-tile-server-16-04-2-lts/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/05/JavaScript-memory-leak/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiuY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiuY's TechBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/05/JavaScript-memory-leak/" itemprop="url">JavaScript memory leak</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-05T17:28:32+08:00">
                2018-02-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>JavaScript is secretly a functional programming language, and its functions are closures: function objects get access to variables defined in their enclosing scope, even when that scope is finished.</p>
<p><strong>Local variables which are captured by a closure are garbage collected once the function they are defined in has finished and all functions defined inside their scope are themselves GCed.</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> theThing = <span class="literal">null</span>;</div><div class="line"><span class="keyword">var</span> replaceThing = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> originalThing = theThing;</div><div class="line">  theThing = &#123;</div><div class="line">    longStr: <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1000000</span>).join(<span class="string">'*'</span>)</div><div class="line">  &#125;;</div><div class="line">&#125;;</div><div class="line">setInterval(replaceThing, <span class="number">1000</span>);</div></pre></td></tr></table></figure>
<p>Every second, we’ll execute the <strong>replaceThing</strong> function. It replaces <strong>theThing</strong> with a new object containing a newly allocated giant string, saving the original value of <strong>theThing</strong> in the local variable <strong>originalThing</strong>. After it returns, the old value of <strong>theThing</strong> can be garbage collected, including the long string inside it, since nothing remains that refers to it. So the memory used by this code is roughly constant.</p>
<p>But what if we had a closure that outlasted <strong>replaceThing</strong>?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> theThing = <span class="literal">null</span>;</div><div class="line"><span class="keyword">var</span> replaceThing = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> originalThing = theThing;</div><div class="line">  theThing = &#123;</div><div class="line">    longStr: <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1000000</span>).join(<span class="string">'*'</span>),</div><div class="line">    someMethod: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(someMessage);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;;</div><div class="line">setInterval(replaceThing, <span class="number">1000</span>);</div></pre></td></tr></table></figure>
<p>Fortunately, modern JavaScript implementations (including, say, the current V8 in Chrome and Node) are smart enough to notice that <strong>originalThing</strong> isn’t <strong>actaully</strong> used in the closure <strong>someMethod</strong>, so it’s not put into someMethod’s lexical environment, and it’s OK to GC the previous theThing when replaceThing finishes.</p>
<p>(But wait, you ask! What if somebody had earlier run <strong>console.log = eval</strong>, and so the seemingly innocuous line <strong>console.log(someMessage)</strong> was actually evaling some code that refers to <strong>originalThing</strong>? Well, the JavaScript standard is one step ahead of you. If you useeval in a sneaky fashion like this (in any way other than by just calling it <strong>eval</strong>), it’s called an “indirect eval”, and it doesn’t actually get to access the lexical environment! If, on the other hand, <strong>someMethod</strong> did contain a direct call to <strong>eval</strong> with that name, it could in fact access <strong>originalThing</strong>, and the JavaScript environment is forbidden from keeping <strong>originalThingout</strong> of the lexical environment and this would end up leaking.)</p>
<p>Well, great! JavaScript protects us from memory leaks, right? Well, let’s try one more version, combining the first two examples.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> theThing = <span class="literal">null</span>; </div><div class="line"><span class="keyword">var</span> replaceThing = <span class="function"><span class="keyword">function</span>（）</span>&#123; </div><div class="line">  <span class="keyword">var</span> originalThing = theThing; </div><div class="line">  <span class="keyword">var</span> unused = <span class="function"><span class="keyword">function</span>（）</span>&#123; </div><div class="line">    <span class="keyword">if</span>（originalThing）</div><div class="line">      <span class="built_in">console</span>.log（“hi”）; </div><div class="line">  &#125;; </div><div class="line">  theThing = &#123; </div><div class="line">    longStr：<span class="keyword">new</span> <span class="built_in">Array</span>（<span class="number">1000000</span>）.join（<span class="string">'*'</span>），</div><div class="line">    someMethod：<span class="function"><span class="keyword">function</span>（）</span>&#123; </div><div class="line">      <span class="built_in">console</span>.log（someMessage）; </div><div class="line">    &#125; </div><div class="line">  &#125;; </div><div class="line">&#125;; </div><div class="line">setInterval（replaceThing，<span class="number">1000</span>）;</div></pre></td></tr></table></figure>
<p>But isn’t this just the same situation as before? <strong>originalThing</strong> is only referenced in the main body of <strong>replaceThing</strong>, and in <strong>unused</strong>. <strong>unused</strong> itself (which we never even run!) gets cleaned up once <strong>replaceThing</strong> ends… the only thing from <strong>replaceThing</strong> that escapes is the second closure, <strong>someMethod</strong>. And <strong>someMethod</strong> doesn’t refer to <strong>originalString</strong> at all!</p>
<p>So even though there’s no way for any code to ever refer to <strong>originalThing</strong> again, it never gets garbage collected! Why? Well, the typical way that closures are implemented is that every function object has a link to a dictionary-style object representing its lexical scope. If both functions defined inside <strong>replaceThing</strong> actually used <strong>originalThing</strong>, it would be important that they both get the same object, even if <strong>originalThing</strong> gets assigned to over and over, so both functions share the same lexical environment. Now, Chrome’s V8 JavaScript engine is apparently smart enough to keep variables out of the lexical environment if they aren’t used byany closures: that’s why the first example doesn’t leak.</p>
<p>But as soon as a variable is used by <strong>any</strong> closure, it ends up in the lexical environment shared byall closures in that scope. And that can lead to memory leaks.</p>
<p>Just add <strong>originalThing = null</strong> to the end of <strong>replaceThing</strong>. That way, even though the name <strong>originalThing</strong> is still in the lexical environment of <strong>someMethod</strong>, there won’t be a link to the big old value.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> theThing = <span class="literal">null</span>;</div><div class="line"><span class="keyword">var</span> replaceThing = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> originalThing = theThing;</div><div class="line">  <span class="comment">// Define a closure that references originalThing but doesn't ever</span></div><div class="line">  <span class="comment">// actually get called. But because this closure exists,</span></div><div class="line">  <span class="comment">// originalThing will be in the lexical environment for all</span></div><div class="line">  <span class="comment">// closures defined in replaceThing, instead of being optimized</span></div><div class="line">  <span class="comment">// out of it. If you remove this function, there is no leak.</span></div><div class="line">  <span class="keyword">var</span> unused = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (originalThing)</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">"hi"</span>);</div><div class="line">  &#125;;</div><div class="line">  theThing = &#123;</div><div class="line">    longStr: <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1000000</span>).join(<span class="string">'*'</span>),</div><div class="line">    <span class="comment">// While originalThing is theoretically accessible by this</span></div><div class="line">    <span class="comment">// function, it obviously doesn't use it. But because</span></div><div class="line">    <span class="comment">// originalThing is part of the lexical environment, someMethod</span></div><div class="line">    <span class="comment">// will hold a reference to originalThing, and so even though we</span></div><div class="line">    <span class="comment">// are replacing theThing with something that has no effective</span></div><div class="line">    <span class="comment">// way to reference the old value of theThing, the old value</span></div><div class="line">    <span class="comment">// will never get cleaned up!</span></div><div class="line">    someMethod: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</div><div class="line">  &#125;;</div><div class="line">  <span class="comment">// If you add `originalThing = null` here, there is no leak.</span></div><div class="line">&#125;;</div><div class="line">setInterval(replaceThing, <span class="number">1000</span>);</div></pre></td></tr></table></figure>
<p>So in summary: If you have a large object that is used by some closures, but not by any closures that you need to keep using, just make sure that the local variable no longer points to it once you’re done with it. </p>
<p><a href="https://blog.meteor.com/an-interesting-kind-of-javascript-memory-leak-8b47d2e7f156" target="_blank" rel="external">https://blog.meteor.com/an-interesting-kind-of-javascript-memory-leak-8b47d2e7f156</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/09/新媒体时代的数据可视化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiuY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiuY's TechBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/09/新媒体时代的数据可视化/" itemprop="url">新媒体时代的数据可视化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-09T16:08:38+08:00">
                2017-10-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="新媒体时代的数据可视化-–-浙大陈为教授分享"><a href="#新媒体时代的数据可视化-–-浙大陈为教授分享" class="headerlink" title="新媒体时代的数据可视化 – 浙大陈为教授分享"></a>新媒体时代的数据可视化 – 浙大陈为教授分享</h1><h2 id="数据可视化是什么"><a href="#数据可视化是什么" class="headerlink" title="数据可视化是什么"></a>数据可视化是什么</h2><p><img src="/2017/10/09/新媒体时代的数据可视化/v1.png" alt=""><br><img src="/2017/10/09/新媒体时代的数据可视化/v2.png" alt=""></p>
<blockquote>
<p>人眼多线程并行传感器，信息通量很大，一图胜千言</p>
</blockquote>
<h4 id="视觉通道"><a href="#视觉通道" class="headerlink" title="视觉通道"></a>视觉通道</h4><ul>
<li>颜色、大小、形状、宽高、纹理、位置 等</li>
</ul>
<h2 id="可视化的定义"><a href="#可视化的定义" class="headerlink" title="可视化的定义"></a>可视化的定义</h2><p><img src="/2017/10/09/新媒体时代的数据可视化/definition.png" alt=""><br>Computer-based visualization systems provide visual representations of datasts intended to help people carrt out some task more effectively.</p>
<p>几何形态 &lt;==&gt; 数据模型</p>
<h3 id="可视化作用"><a href="#可视化作用" class="headerlink" title="可视化作用"></a>可视化作用</h3><ul>
<li>记录信息</li>
<li>传播信息</li>
<li>分析推理</li>
</ul>
<blockquote>
<p>记录信息</p>
</blockquote>
<h4 id="拿破仑东征"><a href="#拿破仑东征" class="headerlink" title="拿破仑东征"></a>拿破仑东征</h4><p><img src="/2017/10/09/新媒体时代的数据可视化/Napoleon.gif" alt=""><br><a href="https://www.edwardtufte.com/tufte/minard" target="_blank" rel="external">https://www.edwardtufte.com/tufte/minard</a></p>
<p>用图讲故事</p>
<h4 id="NASA-洋流向量场"><a href="#NASA-洋流向量场" class="headerlink" title="NASA 洋流向量场"></a>NASA 洋流向量场</h4><p><a href="https://www.youtube.com/watch?v=CCmTY0PKGDs" target="_blank" rel="external">https://www.youtube.com/watch?v=CCmTY0PKGDs</a></p>
<blockquote>
<p>传播信息</p>
</blockquote>
<h4 id="让子弹飞"><a href="#让子弹飞" class="headerlink" title="让子弹飞"></a>让子弹飞</h4><p><img src="/2017/10/09/新媒体时代的数据可视化/letbulletfly.png" alt=""></p>
<blockquote>
<p>分析推理</p>
</blockquote>
<h4 id="十九世纪伦敦城的死亡地图"><a href="#十九世纪伦敦城的死亡地图" class="headerlink" title="十九世纪伦敦城的死亡地图"></a>十九世纪伦敦城的死亡地图</h4><p><img src="/2017/10/09/新媒体时代的数据可视化/theGhostMap.jpeg" alt=""><br><a href="http://news.ifeng.com/a/20171006/52364520_0.shtml" target="_blank" rel="external">http://news.ifeng.com/a/20171006/52364520_0.shtml</a></p>
<h4 id="水坝分析"><a href="#水坝分析" class="headerlink" title="水坝分析"></a>水坝分析</h4><p>数字模拟参数与结果之间的关系</p>
<h3 id="可视化目标"><a href="#可视化目标" class="headerlink" title="可视化目标"></a>可视化目标</h3><ul>
<li>信：忠实原文</li>
<li>达：通顺,流畅</li>
<li>雅：优雅,美好</li>
</ul>
<h2 id="新媒体时代的数据可视化"><a href="#新媒体时代的数据可视化" class="headerlink" title="新媒体时代的数据可视化"></a>新媒体时代的数据可视化</h2><ul>
<li>雅虎股票走势</li>
<li>东方航空使用tableau</li>
<li>棱镜门事件分析网络数据</li>
</ul>
<p>1987 科学可视化 科研人员 =&gt; 1990 信息可视化 普通用户 =&gt; 2004 可视分析 分析师</p>
<p>可视化 ={ 图形 + 数据 + 设计 + 交互</p>
<h4 id="FPS游戏可视化分析："><a href="#FPS游戏可视化分析：" class="headerlink" title="FPS游戏可视化分析："></a>FPS游戏可视化分析：</h4><p><img src="/2017/10/09/新媒体时代的数据可视化/cs.png" alt=""><br><a href="http://blog.counter-strike.net/science/maps.html" target="_blank" rel="external">http://blog.counter-strike.net/science/maps.html</a></p>
<h4 id="雅虎电子邮件"><a href="#雅虎电子邮件" class="headerlink" title="雅虎电子邮件"></a>雅虎电子邮件</h4><h4 id="路透社新闻"><a href="#路透社新闻" class="headerlink" title="路透社新闻"></a>路透社新闻</h4><h4 id="微博转发"><a href="#微博转发" class="headerlink" title="微博转发"></a>微博转发</h4><h4 id="微软学术搜索-可视化研究"><a href="#微软学术搜索-可视化研究" class="headerlink" title="微软学术搜索 可视化研究"></a>微软学术搜索 可视化研究</h4><h4 id="CNN-COP17-ECOSPHERE-Project"><a href="#CNN-COP17-ECOSPHERE-Project" class="headerlink" title="CNN #COP17 ECOSPHERE Project"></a>CNN #COP17 ECOSPHERE Project</h4><p><a href="WWW.CNN-ECOSPHERE.COM/COP17">WWW.CNN-ECOSPHERE.COM/COP17</a></p>
<h2 id="浙江大学的数据可视化研究"><a href="#浙江大学的数据可视化研究" class="headerlink" title="浙江大学的数据可视化研究"></a>浙江大学的数据可视化研究</h2><ul>
<li>信息监控</li>
<li>计算仿真</li>
<li>商业智能</li>
<li>信息安全</li>
<li>可视化组件库</li>
<li>智慧地球</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/01/Clojure-Development-Environment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiuY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiuY's TechBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/01/Clojure-Development-Environment/" itemprop="url">Clojure Development Environment</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-01T17:08:50+08:00">
                2017-09-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Pre-condition"><a href="#Pre-condition" class="headerlink" title="Pre-condition"></a>Pre-condition</h2><ul>
<li>MAC OS</li>
<li>JDK 1.8</li>
<li>homebrew</li>
<li>IntelliJ IDEA</li>
</ul>
<h2 id="Setup-clojure"><a href="#Setup-clojure" class="headerlink" title="Setup clojure"></a>Setup clojure</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">brew update</div><div class="line"></div><div class="line">brew install leiningen</div><div class="line"></div><div class="line">brew install clojurescript</div></pre></td></tr></table></figure>
<h2 id="ClojureScript-REPL"><a href="#ClojureScript-REPL" class="headerlink" title="ClojureScript REPL"></a>ClojureScript REPL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lein repl</div></pre></td></tr></table></figure>
<blockquote>
<p>exit repl: control + d</p>
</blockquote>
<h2 id="setup-clojure-IDEA-plugin"><a href="#setup-clojure-IDEA-plugin" class="headerlink" title="setup clojure IDEA plugin"></a>setup clojure IDEA plugin</h2><ul>
<li>Leiningen</li>
<li>Cursive</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/30/MongoDB学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiuY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiuY's TechBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/30/MongoDB学习笔记/" itemprop="url">MongoDB学习笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-30T18:59:36+08:00">
                2017-08-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><p>基于分布式文件存储的数据库</p>
<p>MongoDB中数据的基本单元称为文档(Document)，它是MongoDB的核心概念，由多个键极其关联的值有序的放置在一起组成，数据库中它对应于关系型数据库的行。</p>
<p>数据在MongoDB中以BSON（Binary-JSON）文档的格式存储在磁盘上。</p>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">db</span><span class="selector-class">.collection</span><span class="selector-class">.insert</span>(<span class="selector-tag">document</span>);</div><div class="line"><span class="selector-tag">db</span><span class="selector-class">.collection</span><span class="selector-class">.insert</span>(<span class="selector-attr">[doc1, doc2, ...]</span>);</div><div class="line"></div><div class="line"><span class="selector-tag">db</span><span class="selector-class">.person</span><span class="selector-class">.insert</span>(&#123;<span class="attribute">name</span>:<span class="string">"Liuy"</span>, age: <span class="number">27</span>&#125;);</div></pre></td></tr></table></figure>
<h3 id="查"><a href="#查" class="headerlink" title="查"></a>查</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">show</span> <span class="selector-tag">collections</span></div><div class="line"><span class="selector-tag">db</span><span class="selector-class">.collection</span><span class="selector-class">.find</span>();</div><div class="line"><span class="selector-tag">db</span><span class="selector-class">.collection</span><span class="selector-class">.find</span>(<span class="selector-tag">criteria</span>,<span class="selector-tag">projection</span>);</div><div class="line"></div><div class="line"><span class="selector-tag">db</span><span class="selector-class">.person</span><span class="selector-class">.find</span>(&#123;<span class="attribute">age</span>:&#123;$gt:<span class="number">18</span>&#125;&#125;,&#123;<span class="attribute">name</span>:<span class="number">1</span>&#125;)<span class="selector-class">.sort</span>(&#123;<span class="attribute">age</span>:<span class="number">1</span>&#125;)<span class="selector-class">.limit</span>(5);</div></pre></td></tr></table></figure>
<ul>
<li>criteria – 查询条件，文档类型，可选。</li>
<li>projection– 返回的字段，文档类型，可选,若需返回所有字段，则忽略此参数。</li>
</ul>
<h3 id="改"><a href="#改" class="headerlink" title="改"></a>改</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">db.collection.update(query,update,&#123;<span class="string">upsert:</span><span class="keyword">boolean</span>,<span class="string">multi:</span><span class="keyword">boolean</span>&#125;);</div><div class="line">db.collection.save(document);</div><div class="line"></div><div class="line">db.person.update(&#123;<span class="string">age:</span>&#123;<span class="string">$gt:</span><span class="number">18</span>&#125;&#125;,&#123;<span class="string">$set:</span>&#123;<span class="string">status:</span><span class="string">"A"</span>&#125;&#125;,&#123;<span class="string">multi:</span><span class="literal">true</span>&#125;);</div><div class="line">db.person.save(&#123;<span class="string">name:</span><span class="string">"Tony"</span>,<span class="string">age:</span><span class="number">12</span>,<span class="string">gender:</span><span class="string">"man"</span>&#125;);</div></pre></td></tr></table></figure>
<p>save命令可以<strong>更新</strong>或<strong>插入</strong>一个新文档</p>
<ul>
<li>query：查询条件，文档，和find中的查询条件写法一致。</li>
<li>update：修改内容，文档。</li>
<li>upsert(可选)：如果值为true，那么当集合中没有匹配文档时，创建文档。默认false。</li>
<li>multi(可选)：如果值为true，那么将更新全部符合条件的文档，否则仅更新一个文档，默认false。</li>
</ul>
<h3 id="删"><a href="#删" class="headerlink" title="删"></a>删</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">db</span><span class="selector-class">.collection</span><span class="selector-class">.remove</span>(<span class="selector-tag">query</span>,<span class="selector-tag">justOne</span>);</div><div class="line"></div><div class="line"><span class="selector-tag">db</span><span class="selector-class">.person</span><span class="selector-class">.remove</span>(&#123;<span class="attribute">status</span>:<span class="string">"D"</span>&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>query：BSON类型，删除文档的条件。</li>
<li>justOne：布尔类型，true：只删除一个文档，false：默认值，删除所有符合条件的文档。</li>
</ul>
<h2 id="字段查询"><a href="#字段查询" class="headerlink" title="字段查询"></a>字段查询</h2><h3 id="相等条件"><a href="#相等条件" class="headerlink" title="相等条件"></a>相等条件</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">db</span><span class="selector-class">.person</span><span class="selector-class">.find</span>(&#123;<span class="attribute">status</span>:<span class="string">"A"</span>&#125;);</div></pre></td></tr></table></figure>
<h3 id="比较条件"><a href="#比较条件" class="headerlink" title="比较条件"></a>比较条件</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">db</span><span class="selector-class">.person</span><span class="selector-class">.find</span>(&#123;<span class="attribute">age</span>:&#123;$gt:<span class="number">40</span>&#125;&#125;);</div></pre></td></tr></table></figure>
<h3 id="数组条件"><a href="#数组条件" class="headerlink" title="数组条件"></a>数组条件</h3><blockquote>
<p>当字段包含数组，可以进行数组完全匹配或匹配特定的值 </p>
</blockquote>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 数组完全匹配</span></div><div class="line">db.inventory.<span class="built_in">find</span>( &#123; tags: [ <span class="string">'fruit'</span>, <span class="string">'food'</span>, <span class="string">'citrus'</span> ] &#125; );</div><div class="line"></div><div class="line"><span class="comment">// 单个元素匹配</span></div><div class="line">db.inventory.<span class="built_in">find</span>( &#123; tags: <span class="string">'fruit'</span> &#125; );</div><div class="line"></div><div class="line"><span class="comment">// 特定元素匹配  特定元素匹配需要"字段.索引"形式传入参数。</span></div><div class="line">db.inventory.<span class="built_in">find</span>( &#123; <span class="string">'tags.0'</span> : <span class="string">'fruit'</span> &#125; );</div></pre></td></tr></table></figure>
<h3 id="子文档条件"><a href="#子文档条件" class="headerlink" title="子文档条件"></a>子文档条件</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.mycol.<span class="builtin-name">find</span>(&#123;<span class="string">"access.level"</span>:5&#125;);</div></pre></td></tr></table></figure>
<h2 id="复合查询-AND-OR"><a href="#复合查询-AND-OR" class="headerlink" title="复合查询 AND/OR"></a>复合查询 AND/OR</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">db.collection.<span class="builtin-name">find</span>(&#123;<span class="variable">$and</span>:[doc1,doc2,<span class="built_in">..</span>.]&#125;)</div><div class="line">db.collection.<span class="builtin-name">find</span>(&#123;<span class="variable">$or</span>:[doc1,doc2,<span class="built_in">..</span>.]&#125;)</div><div class="line"></div><div class="line">db.person.<span class="builtin-name">find</span>(&#123;<span class="variable">$and</span>:[&#123;age:&#123;<span class="variable">$gt</span>:30&#125;&#125;,&#123;name:<span class="string">"Lucy"</span>&#125;]&#125;);</div><div class="line">db.person.<span class="builtin-name">find</span>(&#123;<span class="variable">$or</span>:[&#123;status:<span class="string">"A"</span>&#125;,&#123;age:30&#125;]&#125;);</div></pre></td></tr></table></figure>
<h2 id="游标与结果集"><a href="#游标与结果集" class="headerlink" title="游标与结果集"></a>游标与结果集</h2><h3 id="cursor游标"><a href="#cursor游标" class="headerlink" title="cursor游标"></a>cursor游标</h3><blockquote>
<p>find命令并不直接返回结果，而是返回一个结果集的迭代器，即游标。</p>
</blockquote>
<p>可以使用next方法来遍历游标</p>
<figure class="highlight golo"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myCursor = db.inventory.<span class="keyword">find</span>( &#123; type: <span class="string">"food"</span> &#125; );</div><div class="line"><span class="keyword">var</span> myDocument = myCursor.hasNext() ? myCursor.next() : <span class="literal">null</span>;</div><div class="line"><span class="keyword">if</span> (myDocument) &#123;</div><div class="line">    <span class="keyword">var</span> myItem = myDocument.item;</div><div class="line">    <span class="keyword">print</span>(tojson(myItem));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用forEach方法也能实现游标的遍历<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myCursor =  <span class="keyword">db</span>.inventory.find( &#123; <span class="keyword">type</span>: <span class="string">"food"</span> &#125; );</div><div class="line">myCursor.<span class="keyword">forEach</span>(printjson);</div></pre></td></tr></table></figure></p>
<h3 id="结果集"><a href="#结果集" class="headerlink" title="结果集"></a>结果集</h3><p>限制条件<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">db</span><span class="selector-class">.collection</span><span class="selector-class">.find</span>()<span class="selector-class">.limit</span>(<span class="selector-tag">Num</span>)</div><div class="line"><span class="selector-tag">db</span><span class="selector-class">.person</span><span class="selector-class">.find</span>(&#123;&#125;,&#123;<span class="attribute">name</span>:<span class="number">1</span>&#125;)</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/05/Gopher杭州Meetup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiuY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiuY's TechBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/05/Gopher杭州Meetup/" itemprop="url">Gopher杭州Meetup</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-05T15:16:54+08:00">
                2017-08-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Gopher杭州Meetup"><a href="#Gopher杭州Meetup" class="headerlink" title="Gopher杭州Meetup"></a>Gopher杭州Meetup</h1><h2 id="可视化学习-Go-并发编程"><a href="#可视化学习-Go-并发编程" class="headerlink" title="可视化学习 Go 并发编程"></a>可视化学习 Go 并发编程</h2><h3 id="黄庆兵-网易"><a href="#黄庆兵-网易" class="headerlink" title="黄庆兵:网易"></a>黄庆兵:网易</h3><blockquote>
<p>围绕Go并发编程，结合gotrace工具，让你眼见为实学习Go并发编程</p>
</blockquote>
<p>GoTrace + three.js</p>
<p><strong>算法可视化</strong></p>
<h2 id="基于Go的大数据平台"><a href="#基于Go的大数据平台" class="headerlink" title="基于Go的大数据平台"></a>基于Go的大数据平台</h2><h3 id="陈超-七牛"><a href="#陈超-七牛" class="headerlink" title="陈超:七牛"></a>陈超:七牛</h3><blockquote>
<p>大数据一直是我们在谈论的话题，不管你数据到底有多大？陈超带来全新的大数据处理思路。</p>
</blockquote>
<p>七牛云广告</p>
<p><strong>分布式计算调度算法</strong>: 根据CPU、内存、网络、任务分布度等系统资源占用情况进行打分 </p>
<h2 id="Kubernetes语境下的基于Golang的编程范式"><a href="#Kubernetes语境下的基于Golang的编程范式" class="headerlink" title="Kubernetes语境下的基于Golang的编程范式"></a>Kubernetes语境下的基于Golang的编程范式</h2><h3 id="张磊-Hyper项目成员，Kubernetes项目官方Project-Manager和Feature-Maintainer"><a href="#张磊-Hyper项目成员，Kubernetes项目官方Project-Manager和Feature-Maintainer" class="headerlink" title="张磊:Hyper项目成员，Kubernetes项目官方Project Manager和Feature Maintainer"></a>张磊:Hyper项目成员，Kubernetes项目官方Project Manager和Feature Maintainer</h3><blockquote>
<p>介绍Kubernetes项目中面向Etcd的对象控制器、工作队列、自定义资源、容器运行时接口等一系列基于Golang的编程范式，同时讲解开发者如何使用这些范式来“无损”地扩展Kubernetes核心能力的最佳实践。</p>
</blockquote>
<ul>
<li><p>Kubernetes<br>  Kubernetes作为Docker生态圈中重要一员，是Google多年大规模容器管理技术的开源版本，是产线实践经验的最佳表现[G1] 。<br>面向 API ”OO“ Programming</p>
</li>
<li><p>etcd<br>  可用强一致性的服务发现存储仓库  </p>
</li>
<li><p>gRPC<br>  是一个高性能、通用的开源RPC框架，其由Google主要面向移动应用开发并基于HTTP/2协议标准而设计，基于ProtoBuf(Protocol Buffers)序列化协议开发，且支持众多开发语言。</p>
</li>
<li><p>RPC<br>  远程过程调用（英语：Remote Procedure Call，縮寫為RPC）是一个计算机通信协议。 该协议允许运行于一台计算机的程序调用另一台计算机的子程序，而程序员无需额外地为这个交互作用编程。</p>
</li>
</ul>
<h2 id="基于Mesos的容器调度框架"><a href="#基于Mesos的容器调度框架" class="headerlink" title="基于Mesos的容器调度框架"></a>基于Mesos的容器调度框架</h2><h3 id="黄励博-又拍云"><a href="#黄励博-又拍云" class="headerlink" title="黄励博:又拍云"></a>黄励博:又拍云</h3><blockquote>
<p>为了更好地完成云处理服务的负载均衡，零停机升级，自定义策略调度等功能，又拍云用Go实现了自己的容器调度框架<strong>upone</strong>，管理长期服务和定时任务。</p>
</blockquote>
<ul>
<li>Raft<br>Raft 是一种用来管理日志复制的一致性算法</li>
</ul>
<p>报警使用slack</p>
<h2 id="Go使用gRPC-http打造高性能微服务"><a href="#Go使用gRPC-http打造高性能微服务" class="headerlink" title="Go使用gRPC+http打造高性能微服务"></a>Go使用gRPC+http打造高性能微服务</h2><h3 id="谢孟军：GoCN"><a href="#谢孟军：GoCN" class="headerlink" title="谢孟军：GoCN"></a>谢孟军：GoCN</h3><blockquote>
<p>GRPC已成为互联网最佳的通讯标准，如何打造一个高性能的微服务？</p>
</blockquote>
<h3 id="微服务-MicroServices"><a href="#微服务-MicroServices" class="headerlink" title="微服务 MicroServices"></a>微服务 MicroServices</h3><blockquote>
<p>小、独立服务<br>微服务可以按照功能来划分，或披萨理论，开发到部署3-4个人</p>
</blockquote>
<h3 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h3><blockquote>
<p>基于HTTP/2 POST protobuf</p>
</blockquote>
<table>
<thead>
<tr>
<th>JSON</th>
<th>protobuf</th>
</tr>
</thead>
<tbody>
<tr>
<td>plaintext</td>
<td>binary</td>
</tr>
<tr>
<td>human readable</td>
<td>machine readable</td>
</tr>
<tr>
<td>repetitive</td>
<td>compressed</td>
</tr>
<tr>
<td>fast (de)serialization</td>
<td>faster (de) serialization</td>
</tr>
<tr>
<td>Everything supports it</td>
<td>limited support</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>HTTP/1.1</th>
<th>HTTP/2</th>
</tr>
</thead>
<tbody>
<tr>
<td>plaintext</td>
<td>binary</td>
</tr>
<tr>
<td>no pipelining</td>
<td>native pipelining</td>
</tr>
<tr>
<td>new connection per request</td>
<td>persistent TCP</td>
</tr>
<tr>
<td>repetitive</td>
<td>compressed</td>
</tr>
<tr>
<td>polling</td>
<td>streaming</td>
</tr>
<tr>
<td>Non-secure by default</td>
<td>TLS by default</td>
</tr>
<tr>
<td>Everything supports it</td>
<td>limited support</td>
</tr>
</tbody>
</table>
<ul>
<li>REST<br>  REpresentational State Transfer，全称是 Resource Representational State Transfer：通俗来讲就是：资源在网络中以某种表现形式进行状态转移。<br>  URL定位资源，用HTTP动词（GET,POST,DELETE,DETC）描述操作。</li>
</ul>
<h3 id="如何使用gRPC-http打造微服务"><a href="#如何使用gRPC-http打造微服务" class="headerlink" title="如何使用gRPC+http打造微服务"></a>如何使用gRPC+http打造微服务</h3><h3 id="为什么GO适合做微服务"><a href="#为什么GO适合做微服务" class="headerlink" title="为什么GO适合做微服务"></a>为什么GO适合做微服务</h3><ul>
<li>小</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/04/NEV图表对比/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiuY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiuY's TechBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/04/NEV图表对比/" itemprop="url">NEV与其他图表引擎的横向对比</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-04T11:08:44+08:00">
                2017-08-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="NEV与其他图表引擎的横向对比"><a href="#NEV与其他图表引擎的横向对比" class="headerlink" title="NEV与其他图表引擎的横向对比"></a>NEV与其他图表引擎的横向对比</h1><blockquote>
<p>对比的其他图表库包括<strong>vega</strong>、<strong>HighCharts</strong>、 <strong>ECharts</strong>以及<strong>G2</strong></p>
</blockquote>
<h2 id="图表类型"><a href="#图表类型" class="headerlink" title="图表类型"></a>图表类型</h2><ul>
<li>柱状图</li>
</ul>
<table>
<thead>
<tr>
<th>—-</th>
<th>vega</th>
<th>HighCharts</th>
<th>Echarts</th>
<th>G2</th>
<th>NEV</th>
</tr>
</thead>
<tbody>
<tr>
<td>堆叠柱状图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>并列柱状图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>百分比堆叠柱状图</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>✅表计算</td>
</tr>
<tr>
<td>并列堆叠柱状图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>转置柱状图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody>
</table>
<ul>
<li>折线图、区域图</li>
</ul>
<table>
<thead>
<tr>
<th>—-</th>
<th>vega</th>
<th>HighCharts</th>
<th>Echarts</th>
<th>G2</th>
<th>NEV</th>
</tr>
</thead>
<tbody>
<tr>
<td>普通折线图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>平滑折线图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>转置折线图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>区域图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>百分比堆叠区域图</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>✅表计算</td>
</tr>
<tr>
<td>范围区域图</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>转置区域图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody>
</table>
<ul>
<li>饼图</li>
</ul>
<table>
<thead>
<tr>
<th>—-</th>
<th>vega</th>
<th>HighCharts</th>
<th>Echarts</th>
<th>G2</th>
<th>NEV</th>
</tr>
</thead>
<tbody>
<tr>
<td>饼图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>玫瑰图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>环形图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>环形玫瑰图</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>笛卡尔饼图</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
</tr>
</tbody>
</table>
<ul>
<li>散点图、气泡图</li>
</ul>
<table>
<thead>
<tr>
<th>—-</th>
<th>vega</th>
<th>HighCharts</th>
<th>Echarts</th>
<th>G2</th>
<th>NEV</th>
</tr>
</thead>
<tbody>
<tr>
<td>散点图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>文本图</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr>
<td>气泡图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody>
</table>
<ul>
<li>地图</li>
</ul>
<table>
<thead>
<tr>
<th>—-</th>
<th>vega</th>
<th>HighCharts</th>
<th>Echarts</th>
<th>G2</th>
<th>NEV</th>
</tr>
</thead>
<tbody>
<tr>
<td>地图散点图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>填充地图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>迁徙地图</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>✅nev-lite</td>
</tr>
<tr>
<td>热力地图</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>✅nev-lite</td>
</tr>
</tbody>
</table>
<ul>
<li>组合图</li>
</ul>
<table>
<thead>
<tr>
<th>—-</th>
<th>vega</th>
<th>HighCharts</th>
<th>Echarts</th>
<th>G2</th>
<th>NEV</th>
</tr>
</thead>
<tbody>
<tr>
<td>折现柱状图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>散点柱状图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>地图饼图</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
</tr>
</tbody>
</table>
<ul>
<li>高级图表</li>
</ul>
<table>
<thead>
<tr>
<th>—-</th>
<th>vega</th>
<th>HighCharts</th>
<th>Echarts</th>
<th>G2</th>
<th>NEV</th>
</tr>
</thead>
<tbody>
<tr>
<td>子弹图</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr>
<td>仪表图</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>树图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>词云</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr>
<td>漏斗图</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>热力图</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>3D图</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>关系图</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>雷达图</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>箱线图</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>平行坐标系</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>桑基图</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>瀑布图</td>
<td>❌</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr>
<td>甘特图</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
</tr>
</tbody>
</table>
<ul>
<li>图表高级功能</li>
</ul>
<table>
<thead>
<tr>
<th>—-</th>
<th>vega</th>
<th>HighCharts</th>
<th>Echarts</th>
<th>G2</th>
<th>NEV</th>
</tr>
</thead>
<tbody>
<tr>
<td>对数轴</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>时间轴</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>双轴</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>透视</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>参考线</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr>
<td>主题样式</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
</tr>
</tbody>
</table>
<h2 id="移动端定制版支持"><a href="#移动端定制版支持" class="headerlink" title="移动端定制版支持"></a>移动端定制版支持</h2><table>
<thead>
<tr>
<th>图表库</th>
<th>详细</th>
</tr>
</thead>
<tbody>
<tr>
<td>vega</td>
<td>❌</td>
</tr>
<tr>
<td>HighCharts</td>
<td>❌</td>
</tr>
<tr>
<td>Echarts</td>
<td>❌</td>
</tr>
<tr>
<td>G2</td>
<td>✅ 有移动端版，但该仅支持部分图表且无交互</td>
</tr>
<tr>
<td>NEV</td>
<td>✅ 几乎所有图表均提供移动端定制版，且针对移动端提供定制化交互</td>
</tr>
</tbody>
</table>
<h2 id="交互丰富程度与定制性"><a href="#交互丰富程度与定制性" class="headerlink" title="交互丰富程度与定制性"></a>交互丰富程度与定制性</h2><table>
<thead>
<tr>
<th>图表库</th>
<th>交互丰富程度</th>
<th>移动端交互</th>
<th>可定制性</th>
</tr>
</thead>
<tbody>
<tr>
<td>vega</td>
<td>⭐️⭐️</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr>
<td>HighCharts</td>
<td>⭐️⭐️</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>Echarts</td>
<td>⭐️⭐️⭐️⭐️⭐️</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>G2</td>
<td>⭐️⭐️⭐️⭐️</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>NEV</td>
<td>⭐️⭐️⭐️⭐️</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody>
</table>
<h2 id="图表扩展组合能力"><a href="#图表扩展组合能力" class="headerlink" title="图表扩展组合能力"></a>图表扩展组合能力</h2><table>
<thead>
<tr>
<th>图表库</th>
<th>详细</th>
</tr>
</thead>
<tbody>
<tr>
<td>vega</td>
<td>✅</td>
</tr>
<tr>
<td>HighCharts</td>
<td>❌</td>
</tr>
<tr>
<td>Echarts</td>
<td>❌</td>
</tr>
<tr>
<td>G2</td>
<td>✅    </td>
</tr>
<tr>
<td>NEV</td>
<td>✅</td>
</tr>
</tbody>
</table>
<h2 id="接口功能与易用性"><a href="#接口功能与易用性" class="headerlink" title="接口功能与易用性"></a>接口功能与易用性</h2><table>
<thead>
<tr>
<th>图表库</th>
<th>接口功能</th>
<th>易用性</th>
</tr>
</thead>
<tbody>
<tr>
<td>vega</td>
<td>⭐️⭐️⭐️⭐️</td>
<td>⭐️⭐️</td>
</tr>
<tr>
<td>HighCharts</td>
<td>⭐️⭐️</td>
<td>⭐️⭐️⭐️⭐️</td>
</tr>
<tr>
<td>Echarts</td>
<td>⭐️⭐️</td>
<td>⭐️⭐️⭐️⭐️</td>
</tr>
<tr>
<td>G2</td>
<td>⭐️⭐️⭐️⭐️</td>
<td>⭐️⭐️⭐️⭐️</td>
</tr>
<tr>
<td>NEV</td>
<td>⭐️⭐️⭐️⭐️⭐️</td>
<td>⭐️⭐️</td>
</tr>
</tbody>
</table>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p><strong>vega</strong>: 绘图功能强大，遵循图形语法，因此带来了强大的图表组合能力，但由于是非商业化的开源项目，因此在视觉、交互等方面有所欠缺，而且接口复杂，学习曲线略微陡峭。</p>
</li>
<li><p><strong>HighCharts</strong>: 图表类型丰富，不支持图表元素组合扩展，带有商业性质的项目，商业用途需购买授权，难以进行二次开发，对于不支持的图表难以扩展。</p>
</li>
<li><p><strong>Echarts</strong>: 图表类型丰富，提供良好的视觉和交互体验，不遵循图形语法，不能进行图表组合扩展，免费开源项目，可以用于商业用途，难以进行二次开发，对于不支持的图表难以扩展。</p>
</li>
<li><p><strong>G2</strong>: 遵循图形语法，接口使用方便，非开源项目，各方面能力较为均衡。</p>
</li>
<li><p><strong>NEV</strong>: 遵循图形语法，具有图表组合扩展能力，支持用户进行高度定制化的配置需求，提供良好的视觉和交互体验，提供移动端定制版，支持交互定制，高度支持图表透视功能，缺点是用户接口使用略有不便。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/22/来聊聊地图投影的学问/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiuY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiuY's TechBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/22/来聊聊地图投影的学问/" itemprop="url">来聊聊地图投影的学问</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-22T02:10:43+08:00">
                2017-03-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="来聊聊地图投影的学问"><a href="#来聊聊地图投影的学问" class="headerlink" title="来聊聊地图投影的学问"></a>来聊聊地图投影的学问</h1><blockquote>
<p>地图所有人都很熟悉，但估计许多人都不知道我们平时看到的地图中是存在许多门道的，今天我就来一一道来。</p>
</blockquote>
<p>先来看看我们平时最常见的世界地图是长这样的。</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/1.jpg" alt=""></p>
<p>我们很容易联想到这样一个图形是无法平整的贴在一个球体表面的。真正要帖在球体表面的地图是下图这样的，而且即便如此，也只是近似平整而已。</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/2.jpg" alt=""></p>
<p>由于地球是一个近似球体，地球表面是一个不可展开面，因此将地球表面展开后必然会出现撕裂和褶皱。将三维的地球表面映射到二维平面的过程就是地图的投影。而由于空间维度的降低，在投影的过程中，地图的扭曲和形变是无法避免的，因此，在绘制世界地图时，面积、方向和距离是无法全部顾及到。</p>
<p>以刚刚的世界地图举例：上面的世界地图采用的投影方式叫做<strong>等差分纬线多圆锥投影</strong>，该投影中纬线为对称于赤道的同轴圆圆弧，圆心位于中央经线上。中央经线为一直线，其它经线为对称于中央经线的曲线，且离中央经线越远，其经线间隔成比例地递减；极点表示为圆弧，其长度为赤道投影长度的二分之一，经纬网的图形有球形感。我国被配置在地图中接近于中央的位置，保持太平洋完整。由于该投影的性质是接近等面积的任意投影，因此我国绝大部分地区面积变形小。在中学使用的世界地图中的世界的气候类型和洋流图、世界政区图和自然带的分布图都是采用的这种投影图。</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/3.jpg" alt=""></p>
<p>上图显示了等差分纬线多圆锥投影投影形变的程度，图中的1.0线表示面积形变为0，大于1.0表示图上面积比起实际面积放大了，小于1.0表示图上面积比起实际面积缩小了。我国之所以普遍采用这种投影方式也有一部分原因是我国大部分国土面积都处于低形变程度的地图中。</p>
<p>此外，使用这种投影还存在的问题是：<strong>即使是在实际中互相垂直的方向，在地图中却表现为非垂直</strong>。例如下图中的经线和纬线。</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/4.png" alt=""></p>
<p>为了真实表示地图中的方向，就得提到大名鼎鼎的<strong>墨卡托投影（Mercator Projection）</strong>，其投影出的世界地图如下图所示，经线纬线互相垂直并且方向正确。墨卡托投影被广泛应用例如谷歌地图、网易有数等地图场景（此处为硬广：<strong>网易有数</strong>能够绘制填充地图、地图散点图等多种图表类型，并且提供面向全国省市级的可视化数据分析功能，快戳<a href="http://youdata.163.com" target="_blank" rel="external">http://youdata.163.com</a>试用）</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/5.jpg" alt=""></p>
<p>墨卡托投影是圆柱投影的一种，是由地理学家墨卡托于16世纪发明的。和所有其它的圆柱投影一样，麦卡托投影的世界地图中，地球纬线是左右方向平行的，长度一样，覆盖整个地图的画幅；而经线是上下方向平行，垂直于纬线。然而在现实世界里，这显然是不对的：如果你拿来一个地球仪仔细观察，就能发现地球的纬线虽然是平行的，但长度却不一样：赤道最长，越往两级方向越短。而经线虽然都是一样长的，但它们并不平行，而是在南极和北极交汇成点。</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/6.jpg" alt=""></p>
<p>墨卡托投影的绘制方式是将一张纸卷成圆筒状包住地球，纸面接触地球赤道，模拟地球球心为光源，将地球表面轮廓照射到圆筒上从而形成的地图。在赤道上，由于地球和纸面接触，因此投影出的面积和方向也是完全真实的。然而，离开赤道往南北级方向可以明显发现，投影出的图案面积发生了形变。由于光源在球心，因此南极点和北极点将不会出现在投影中，甚至两级的极圈也不会被投影在地图中。</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/7.png" alt=""></p>
<p>假设R为赤道半径，r为北纬60度纬线的半径。r/R=sin(90-60)=0.5，周长=2 <em> pi </em> 半径，因此赤道的半径是北纬60度的2倍。然而，在墨卡托投影的世界地图里，北纬六十度和赤道是一样长的。因此为了保持大陆的形状，在北纬六十度，地图的南北方向也被拉长了2倍。因此，在墨卡托投影的地图中，高纬度的地区会被放大许多。</p>
<p>这种放大有多夸张呢，这里给大家几张动图感受一下。</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/中国.gif" alt=""><br><img src="/2017/03/22/来聊聊地图投影的学问/俄罗斯.gif" alt=""><br><img src="/2017/03/22/来聊聊地图投影的学问/格陵兰岛.gif" alt=""></p>
<p>链接在这里，自己玩玩吧：<a href="http://thetruesize.com" target="_blank" rel="external">http://thetruesize.com</a></p>
<p>然而，即使墨卡托投影存在这样的问题，依然难以阻挡它的广泛应用，另外，选取不同的基准线，画出的地图也可以有不同的特性。</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/8.png" alt=""></p>
<p>这里再介绍几种常见的投影方式以作对比：</p>
<p>最后还要强调一点墨卡托投影或者说大多数投影都存在的一个误区：<strong>地图上两点之间的距离未必是实际中的最短距离</strong>。例如从英国伦敦飞到美国西雅图的民航航线是这样的：</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/9.jpg" alt=""></p>
<p>弧线是航班的真实路线。而在平面投影或地球仪上可以明显观察到，上图中这条弧线才是两座城市间的最近距离。</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/10.jpg" alt=""></p>
<ul>
<li>等角度投影</li>
</ul>
<p><strong>正切方位投影</strong>，主要用于两极地区地图。以极地为投影中心，又称球面极地投影。纬线为以极为中心的同心圆，经线为由极向四周辐射的直线，纬距由中心向外扩大。投影中央部分的长度和面积变形小，向外逐渐增大。</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/11.jpg" alt=""></p>
<ul>
<li>等面积投影</li>
</ul>
<p><strong>摩尔威德投影</strong>是一种伪圆柱投影，和圆柱投影有相似之处，但又用数学方法进行了优化。这种投影方法保持了面积的准确性，也在较大的程度上控制了形状的形变量。它选择一条经线最作为基准，然后把这条经线向东和向西各90度的两条组成大圆的经线在地图上画成一个圆，效果如图所示： </p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/12.png" alt=""></p>
<ul>
<li>等距离投影</li>
</ul>
<p><strong>等距离圆柱投影</strong>（Equidistant Cylindrical Projection）。它是公认的所有地图投影里，数学变换最简单的一种。麦卡托投影在高纬度地区为了保持形状的准确而将纬线之间的距离拉长；等距离圆锥投影的所有相邻经线和纬线之间的距离都是一样的。因此，在南北方向上，地图上任意两点的距离是保持精确的。这种地图缺点很多，既不保持形状的准确，也不保证面积的准确。但因为它制作简单，因此很多时候它被用作索引地图（例如世界各国列表）或示意地图（例如时区、货币分布、国际组织成员分布等地图）的投影。</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/13.png" alt=""></p>
<ul>
<li>面积、角度、距离最折中的方案</li>
</ul>
<p><strong>罗宾逊投影</strong>（Robinson Projection）。前面一直在讨论，在把3维的地球转化为2维的地图的过程中，等方面的精确度不能个个都保全。于是，制图学家们开始寻找有没有折中方案，让这几方面的变形程度尽可能最小化。罗宾逊投影就是这些尝试的其中一个结果。它的效果如下： </p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/14.jpg" alt=""></p>
<p>罗宾逊投影中，形状、面积和角度等都做不到精确，然而它们之间进行了互相的妥协。和麦卡托地图相比，它的陆地轮廓形状发生了可以接受的扭曲，而高纬度地区的面积变化虽然还存在，但也变小了不少。这种投影方法被发明后，很快就被用于绘制各种各样的世界地图了。</p>
<p>所以说，究竟有没有一种等积等距等角度的地图呢？当然有，买个地球仪吧。</p>
<p><img src="/2017/03/22/来聊聊地图投影的学问/15.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="LiuY" />
          <p class="site-author-name" itemprop="name">LiuY</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiuY</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
